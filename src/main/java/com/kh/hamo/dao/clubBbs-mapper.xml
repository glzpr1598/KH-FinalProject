<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">    
<mapper namespace="com.kh.hamo.dao.ClubBbsInter">

	<!-- 회장 닉네임 찾기 -->
	<select id="findMaster" resultType="String" parameterType="HashMap">
		SELECT club_masterNickname FROM club WHERE club_id=#{club_id} AND member_id=#{member_id}
	</select>

	<!-- 공지사항 리스트 -->
	<select id="clubNoticeList" resultType="com.kh.hamo.dto.ClubBbsDTO">
		SELECT c.club_id, cb.clubBbs_id, cb.clubBbs_idx, cb.clubBbs_subject, c.club_masterNickname, cb.clubBbs_date, cb.clubBbs_hit FROM clubBbs cb JOIN club c ON cb.member_id = c.member_id WHERE cb.clubBbs_sort=#{param2} AND c.club_id=#{param1} ORDER BY clubBbs_idx DESC 
	</select>
	
	<!-- 조회수 올리기 -->
	<update id="clubBbsHit">
		UPDATE clubBbs SET clubBbs_hit = clubBbs_hit+1 WHERE clubBbs_id=#{param1}
	</update>
	
	<!-- 공지사항 상세보기 -->
	<select id="clubNoticeDetail" resultType="com.kh.hamo.dto.ClubBbsDTO">
		SELECT cb.club_id, cb.clubBbs_id, cb.clubBbs_subject, c.club_masterNickname, cb.clubBbs_hit, cb.clubBbs_date, cb.clubBbs_content FROM clubBbs cb JOIN club c ON cb.member_id = c.member_id WHERE cb.clubBbs_id=#{param1}
	</select>
	
	<!-- 댓글 수 조회 -->
	<select id="findReply" resultType="com.kh.hamo.dto.ClubBbsDTO">
		SELECT clubBbs_replyCount FROM clubBbs WHERE clubBbs_id=#{param1}
	</select>
	
	<!-- 댓글 리스트 조회 -->
	<select id="clubReplyList" resultType="com.kh.hamo.dto.ClubBbsDTO">
		SELECT cb.clubBbsReply_id, cj.clubJoin_nickname, cb.clubBbsReply_content, cb.clubBbsReply_date FROM clubBbsReply cb JOIN clubJoin cj ON cb.member_id = cj.member_id WHERE cb.clubBbs_id = #{param1} ORDER BY cb.clubBbsReply_id DESC
	</select>
	
	<!-- 댓글 작성 -->
	<insert id="clubReply" parameterType="com.kh.hamo.dto.ClubBbsDTO">
		INSERT INTO clubBbsReply VALUES (seq_clubbbsreply_id.NEXTVAL,#{clubBbs_id},#{member_id},#{clubBbsReply_content},SYSDATE)
	</insert>
	
	<!-- 댓글 수 증가 -->
	<update id="replyUp">
		UPDATE clubBbs SET clubBbs_replyCount = clubBbs_replyCount+1 WHERE clubBbs_id=#{param1}
	</update>
	
	<!-- 댓글 삭제 -->
	<delete id="replyDelete">
		DELETE FROM clubBbsReply WHERE clubBbsReply_id=#{param1} 
	</delete>
	
	<!-- 댓글 수 감소 -->
	<update id="replyDown">
		UPDATE clubBbs SET clubBbs_replyCount = clubBbs_replyCount-1 WHERE clubBbs_id=#{param1}
	</update>

</mapper>